<!DOCTYPE html>
<html>
    <head>
        <meta charset="gbk" />
        <title>demo</title>
        <style type="text/css">
            body, form, h1, h2, h3, h4, p, img, ul, li, ol, dl, dt, dd, a, span, input, tr, th, td{margin:0;padding:0;}
		    body {font:normal 12px/1.5 "Arial","ו","Simsun","Tahoma",sans-serif;}
		    li{list-style:none;}
		    img {border:0 none;vertical-align:top;}
		    table {border-collapse:collapse;border-spacing:0;}
            .cf:after{display:block;visibility:hidden;font-size:0;line-height:0;clear:both;content:"";}  
            .cf{zoom:1;}
		    a{color:#000;text-decoration:none;}
		    a:visited{}
		    a:hover{text-decoration:underline;}
		    a:active{}


            .demo-wrap {
                position: relative;
                margin-top: 20px;
                height: 110px;
            }

            #photo-list img  {
                border: 1px solid grey;
                padding: 4px;
                margin: 8px;
            }
            .loading {
                background: transparent url(../static/loading.gif) no-repeat;
                width: 100px;
                height: 100px;
                margin: 20px;
            }
     

    
            
        </style>
        <script src="http://a.tbcdn.cn/s/kissy/1.1.6/kissy-min.js?t=20111130.js"></script>
    </head>
    <body>
        <button id="demo-btn">Fetch Photo</button>
        <button id="demo-reload">Reload!</button>
        <div class="demo-wrap" id="photo-list">
        </div>
        <script>
            (function(S){
                    var DOM = S.DOM, 
                        Event = S.Event,
                        btn = DOM.get('#demo-btn'),
                        reload = DOM.get('#demo-reload');
                    var API = 'http://api.flickr.com/services/rest/?'
                        params = {
                            'method': 'flickr.favorites.getPublicList',
                            'api_key': '5d93c2e473e39e9307e86d4a01381266',
                            'user_id': '26211501@N07',
                            'per_page': 10,
                            'format': 'json',
                            'jsoncallback': 'getFavorites'
                        },
                        photoList = S.one('#photo-list');
                    S.one('#demo-btn').on('click', function(){
                        S.one(this).attr('disabled', true);
                        photoList.addClass('loading');
                        S.getScript(API + S.param(params));
                    });

                    window.getFavorites = function(data) {
                        var html = 'Fetch photo failed, pls try again!';
                        if (data.stat === 'ok') {
                            html = '';
                            S.each(data.photos.photo, function(item, i){
                                html += '<img src="http://farm' + item.farm + '.static.flickr.com/' + item.server + '/' + item.id + '_' + item.secret + '_t.jpg" />';
                            });
                        }
                        photoList.html(html).all('img').each(function(img){
                            img.on('load', function(){
                                if(loading){
                                    photoList.removeClass('loading');
                                    loading = false;
                                }
                                img.fadeIn(3);
                            });
                        });
                        //photoList.removeClass('loading').html(html);
                    }
            })(KISSY);
        </script>

    </body>
</html>
